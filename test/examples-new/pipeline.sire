val N := 10;

func f(val v) is
  return v

proc pipeline(chanend input) is
  chan c[N+1];
  var i;
  var v;
{ { input ? v ; c[0] ! v 
  ; c[N] ? v ; input ! v
  } || 
  par i in [0 for N] do
  { c[i-1] ? v
  ; c[i] ! f(v)
  }
}

proc main() is
  chan c;
  var query;
  var result;
{ { c ! query ; c ? result } ||
  pipeline(c)
}

