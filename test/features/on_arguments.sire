val N := 2;

proc foo(val a, val b, val c, val d, val e, val f, val g, var r) is
  r := a+b+c+d+e+f+g

proc bar(val a, val b, val c, val d, var e[n], val n, var r) is
  var i;
{ r := a+b+c+d
; for i in [0 for n] do r := r + e[i]
}

proc baz(val a, val b, val c, var r, 
    val e[n], val n, val f[m], val m) is
  var i;
{ r := a+b+c
; for i in [0 for n] do r := r + e[i]
; for i in [0 for m] do r := r + f[i]
}

proc cat(val w[a], val x[b], val y[c], val z[d],
    val a, val b, val c, val d) is
  var i;
  var r;
{ r := 0
; for i in [0 for a] do r := r + w[i]
; for i in [0 for b] do r := r + x[i]
; for i in [0 for c] do r := r + y[i]
; for i in [0 for d] do r := r + z[i]
}

proc main() is
  var i;
  var r;
  var a[N];
  var b[2*N];
  var c[3*N];
  var d[4*N];
{ 
  % All 8 arguments with a referenced var
  on NUM_CORES-1 do foo(1, 2, 3, 4, 5, 6, 7, r)
; printvalln(r)

  % An array onto the stack with a referenced var
; for i in [0 for N]   do a[i] := 5+i
; on NUM_CORES-1 do bar(1, 2, 3, 4, a, N, r)
; printvalln(r)

 % Two arrays onto the stack
; for i in [0 for N]   do a[i] := 4+i
; for i in [0 for 2*N] do b[i] := a[N-1]+i
; on NUM_CORES-1 do baz(1, 2, 3, r, a, N, b, 2*N)
; printvalln(r)

 % Four arrays onto the stack
; for i in [0 for 3*N] do c[i] := i 
; for i in [0 for 4*N] do d[i] := i 
; on NUM_CORES-1 do cat(a, b, c, d, N, N*2, N*3, N*4)
}

